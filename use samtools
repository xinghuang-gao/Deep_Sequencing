# SAM/BAM files generated by an aliger such as Bowtie2 need processing, sorting, indexing or merging. 2 packages: C-based samtools and picard

1. Installation
# download samtools 1.9
$mkdir samtools
$cd samtools
$curl https://github.com/samtools/samtools/releases/download/1.9/samtools-1.9.tar.bz2
$tar jxvf samtools-1.9.tar.bz2 #decompress the download file
$./configure # or $./configure --prefix= absolute path
$make
$make install
$.samtools--help #read help documents
# change the enviroment variable, configure the path as following PATH=$PATH:<PATH 1>:<PATH 2>:<PATH 3>:------:<PATH N>
$PATH=$PATH:/Users/xing-huanggao/samtools-1.9
$source .bash_profile # immediately refresh bash profile and run samtools
$samtools view

#eavluate mapping quality, use RseQc python-based package, -i as input
$ bam_stat.py  -i /Users/Maria/Desktop/XGAO-newimac/map_seq/sam/ctl_aligned_trim_sickle.sam > /Users/Maria/Desktop/XGAO-newimac/map_seq/sam/mq_700.txt

# list how many reads map to each chromosome
$samtools idxstats alignments.sorted.bam

#filter alignents based on mapping quality. the following keeps alignments which have mapping quality higher than 20 (1% mismatched)
$samtools view -b -q 30 â€“o alignments_MQmin30.bam alignments.bam
# look at SAM/BAM header 
$samtools view -H ~/filename.sam

# convert SAM into BAM with the -b option
$samtools view -b filename.sam > filename_copy.bam

# convert BAM into SAM
$samtools view filename.bam > filename_copy.sam

# sort and index
# These allow for faster access to reads aligned within a certain region.
$samtools sort filename_unsorted.bam -o filename_sorted #.bam extension will be included by sort

# postion-sorted BAM files are the starting points for SNP calling and extracting alignments from specific regions.

#to index a postion-sorted BAM file, SAM files can not be indexed.
$samtools index filename_sorted.bam #creat a file named filename_sorted.bam.bai, contains the index.

# view the alignment data with samtools tview. IGV from Broad can be also used for visulizing alignments.
#samtool tview requries to use sorted BAM file as input
$samtools tview filename_sorted.bam




